<!DOCTIPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<head>
	  <title>
	    PPV - EJNS
	  </title>
	  <script src="js/sessionCookie.js" type="text/javascript"></script>
  	<script src="js/js_utils.js" type="text/javascript"></script>
	</head>
	<!--<link rel="stylesheet" type="text/css" href="css/index.css" />-->
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<body>
	  <h1 class="titulo"> PPV - Plano Pessoal de Vida </h1>
	  <form id="login" onsubmit="return false;">
	    <label class="login-label" for="usuario">Usuário:</label><br>
	    <input id="usuario" type="text" /><br><br>	
	    <label class="login-label" for="senha">Senha:</label><br>
	    <input id="senha" type="password" /><br><br>
	    <p id="erro_login" class="erro"></p>
	    <input type="button" value="Entrar" onclick="autenticar();" />
	  </form>
	</body>
</html>
<script language="JavaScript">

window.onload = function() {
  if (readCookie('id_usuario') && readCookie('id_usuario') !== 0) {
  	
  	window.location.href = "seleciona_tela.html";
  }
}

function autenticar(){

  	var usuario = document.getElementById('usuario').value;
		var senha   = document.getElementById('senha').value;

		if (usuario == '' || senha == '') {
			document.getElementById('erro_login').innerHTML = "Informe usuário e senha.";
			return false;
		}

    var oParams = new Object();
  	oParams.method = 'autenticar';
  	oParams.login  = usuario;
  	oParams.senha  = senha;

    AJAXRequest("POST", oParams, "concluiAutenticacao");

}

function concluiAutenticacao(oAjax) {
            
  var obj = oAjax;
  
  if (obj.status == 0) {

  	with (obj.usuario) {
  		//os dados de uma sessão de login (cookies) duram uma semana
			writeCookie('id_usuario', id_usuario, 7);
			writeCookie('nome', nome, 7);
			writeCookie('data_nasc', data_nasc, 7);
			writeCookie('id_tipousuario', id_tipousuario, 7);
			writeCookie('tipo_usuario', tipo_usuario, 7);
			writeCookie('responde', perm_responde, 7);
			writeCookie('le_respostas', perm_le_resposta, 7);
			writeCookie('equipe', nome_equipe, 7);
			writeCookie('setor', setor, 7);
  	}
  	window.location.href = "seleciona_tela.html";
  } else {
		document.getElementById('erro_login').innerHTML = "Erro no login. Verifique se o usuário e a senha estão corretos.";
  }
}
</script>